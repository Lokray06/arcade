version: "3.9"

services:
  arch-dev:
    build:
      context: .
      args:
        USER_NAME: ${USER_NAME}
        USER_PASSWORD: ${USER_PASSWORD}
        DOTFILES_REPO: ${DOTFILES_REPO}
        INSTALL_NIRI: ${INSTALL_NIRI:-false} # Default to false if not set
    container_name: arch-dev
    restart: unless-stopped
    ports:
      - "${SSH_PORT}:22"
    volumes:
      - /var/run/dbus/system_bus_socket:/var/run/dbus/system_bus_socket
      - arcade-home:/home/${USER_NAME}
    devices:
      - /dev/dri:/dev/dri
    shm_size: '2gb'
    device_cgroup_rules:
      - 'c 226:* rmw' # Allows access to GPU rendering nodes

volumes:
  arcade-home: